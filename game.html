<!DOCTYPE html>
<html>
<head>
    <title>å·ç‹å¤§æˆ˜</title>
    <meta charset="utf-8">
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        button { margin: 5px; padding: 8px; }
        #status { margin-bottom: 20px; }
    </style>
</head>
<body>
    <div id="status"></div>
    <div id="actions"></div>
    <div id="log"></div>

<script>
let gameState = {
    playerHP: 3,
    computerHP: 3,
    playerScrolls: 0,
    computerScrolls: 0,
    round: 1
};

const moves = ['å·', 'åå·', 'èººå¹³', 'ç ´é˜²', 'æ§æ€', 'æ‘†çƒ‚'];

function updateStatus() {
    document.getElementById('status').innerHTML = `
        <h3>ç¬¬ ${gameState.round} å›åˆ</h3>
        <p>ä½ çš„è¡€é‡: ${gameState.playerHP} â¤ï¸ | å·è½´: ${gameState.playerScrolls} ğŸ“œ</p >
        <p>ç”µè„‘è¡€é‡: ${gameState.computerHP} â¤ï¸ | å·è½´: ${gameState.computerScrolls} ğŸ“œ</p >
    `;
}

function computerAI() {
    let validMoves = [];
    
    if (gameState.computerScrolls === 0 && gameState.playerScrolls === 0) {
        validMoves = ['å·'];
    } else if (gameState.playerScrolls > 0 && gameState.playerScrolls < 3) {
        validMoves = ['å·', 'èººå¹³'];
    } else if (gameState.playerScrolls >= 3) {
        validMoves = ['å·', 'èººå¹³', 'æ‘†çƒ‚'];
    }

    if (gameState.computerScrolls > 0) {
        if (gameState.playerScrolls === 0) {
            validMoves = ['å·', 'åå·', 'æ§æ€', 'ç ´é˜²'].filter(move => {
                if (move === 'åå·' && gameState.computerScrolls < 1) return false;
                if (move === 'æ§æ€' && gameState.computerScrolls < 3) return false;
                return true;
            });
        }
    }
    
    return validMoves[Math.floor(Math.random() * validMoves.length)] || 'å·';
}

function battle(playerMove) {
    const computerMove = computerAI();
    let log = `ä½ å‡ºæ‹›ï¼š${playerMove}<br>ç”µè„‘å‡ºæ‹›ï¼š${computerMove}<br>`;

    // å¤„ç†ç©å®¶åŠ¨ä½œ
    if (playerMove === 'å·') {
        gameState.playerScrolls++;
    } else if (playerMove === 'åå·') {
        gameState.playerScrolls--;
        if (computerMove !== 'èººå¹³') {
            gameState.computerHP--;
        }
    } else if (playerMove === 'æ§æ€') {
        gameState.playerScrolls -= 3;
        if (computerMove !== 'æ‘†çƒ‚') {
            gameState.computerHP -= 2;
        }
    } else if (playerMove === 'ç ´é˜²') {
        gameState.playerScrolls--;
        if (['èººå¹³', 'æ‘†çƒ‚'].includes(computerMove)) {
            gameState.computerHP--;
        }
    }

    // å¤„ç†ç”µè„‘åŠ¨ä½œ
    if (computerMove === 'å·') {
        gameState.computerScrolls++;
    } else if (computerMove === 'åå·') {
        gameState.computerScrolls--;
        if (playerMove !== 'èººå¹³') {
            gameState.playerHP--;
        }
    } else if (computerMove === 'æ§æ€') {
        gameState.computerScrolls -= 3;
        if (playerMove !== 'æ‘†çƒ‚') {
            gameState.playerHP -= 2;
        }
    } else if (computerMove === 'ç ´é˜²') {
        gameState.computerScrolls--;
        if (['èººå¹³', 'æ‘†çƒ‚'].includes(playerMove)) {
            gameState.playerHP--;
        }
    }

    // æ›´æ–°æ—¥å¿—
    document.getElementById('log').innerHTML = log;
    gameState.round++;

    checkGameOver();
    updateStatus();
    createButtons();
}

function checkGameOver() {
    if (gameState.playerHP <= 0 && gameState.computerHP <= 0) {
        alert("å¹³å±€ï¼");
        resetGame();
    } else if (gameState.playerHP <= 0) {
        alert("ä½ è¾“äº†ï¼");
        resetGame();
    } else if (gameState.computerHP <= 0) {
        alert("ä½ èµ¢äº†ï¼");
        resetGame();
    }
}

function resetGame() {
    gameState = {
        playerHP: 3,
        computerHP: 3,
        playerScrolls: 0,
        computerScrolls: 0,
        round: 1
    };
    updateStatus();
    createButtons();
    document.getElementById('log').innerHTML = '';
}

function createButtons() {
    const actionsDiv = document.getElementById('actions');
    actionsDiv.innerHTML = '';
    
    moves.forEach(move => {
        const btn = document.createElement('button');
        btn.innerHTML = move;
        btn.onclick = () => handleMove(move);
        actionsDiv.appendChild(btn);
        
        // ç¦ç”¨æ— æ•ˆæ“ä½œ
        if (move === 'åå·' && gameState.playerScrolls < 1) btn.disabled = true;
        if (move === 'æ§æ€' && gameState.playerScrolls < 3) btn.disabled = true;
    });
}

function handleMove(move) {
    if (['åå·', 'æ§æ€', 'ç ´é˜²'].includes(move)) {
        if (move === 'åå·' && gameState.playerScrolls < 1) return;
        if (move === 'æ§æ€' && gameState.playerScrolls < 3) return;
    }
    battle(move);
}

// åˆå§‹åŒ–æ¸¸æˆ
updateStatus();
createButtons();
</script>
</body>
</html>